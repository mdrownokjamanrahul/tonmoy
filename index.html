<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶´‡¶æ‡¶∞‡ßç‡¶Æ‡ßá‡¶∏‡ßÄ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            text-align: center;
        }

        .header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .header p {
            color: #7f8c8d;
            font-size: 1.2em;
        }

        .nav-tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            flex-wrap: wrap;
            gap: 10px;
        }

        .tab-button {
            flex: 1;
            min-width: 150px;
            padding: 15px 20px;
            border: none;
            background: transparent;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            color: #666;
        }

        .tab-button.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .tab-content {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            min-height: 500px;
        }

        .tab-panel {
            display: none;
        }

        .tab-panel.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transform: translateY(0);
            transition: transform 0.3s ease;
        }

        .stat-card:nth-child(2) {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
        }

        .stat-card:nth-child(3) {
            background: linear-gradient(135deg, #45b7d1, #96c93d);
        }

        .stat-card:nth-child(4) {
            background: linear-gradient(135deg, #f093fb, #f5576c);
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card h3 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #2c3e50;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
        }

        .btn-success {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .table th, .table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        .table th {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            font-weight: 600;
        }

        .table tr:hover {
            background-color: #f8f9fa;
        }

        .alert {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid transparent;
        }

        .alert-warning {
            background-color: #fff3cd;
            border-color: #ffeaa7;
            color: #856404;
        }

        .alert-success {
            background-color: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }

        .sale-form {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .sale-item {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr auto;
            gap: 15px;
            align-items: center;
            padding: 10px;
            background: white;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .discount-section {
            background: #fff3cd;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #ffc107;
        }

        .discount-section h4 {
            color: #856404;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .discount-row {
            display: grid;
            grid-template-columns: 1fr 1fr 2fr;
            gap: 15px;
            align-items: center;
        }

        .total-section {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .total-breakdown {
            margin-bottom: 15px;
        }

        .total-breakdown div {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .final-total {
            border-top: 2px solid white;
            padding-top: 10px;
            font-size: 1.3em;
            font-weight: bold;
        }

        .search-box {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            margin-bottom: 20px;
        }

        .low-stock {
            background-color: #ffebee !important;
        }

        .expired {
            background-color: #ffcdd2 !important;
        }

        .customer-report {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .print-area {
            display: none;
        }

        @media print {
            .print-area {
                display: block;
            }
            .container, .nav-tabs, .header {
                display: none;
            }
            body {
                background: white;
            }
        }

        .customer-search {
            margin-bottom: 20px;
        }

        .customer-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }

        .customer-item {
            padding: 10px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .customer-item:hover {
            background-color: #f8f9fa;
        }

        .loading {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 9999;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 20px;
            border-radius: 10px;
        }

        .connection-status {
            position: fixed;
            top: 20px;
            left: 20px;
            padding: 10px;
            border-radius: 5px;
            font-weight: bold;
            z-index: 1000;
        }

        .connected {
            background: #d4edda;
            color: #155724;
        }

        .disconnected {
            background: #f8d7da;
            color: #721c24;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .nav-tabs {
                flex-direction: column;
            }
            
            .tab-button {
                min-width: auto;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .sale-item {
                grid-template-columns: 1fr;
                text-align: center;
            }

            .discount-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Connection Status -->
    <div id="connectionStatus" class="connection-status">üîÑ Connecting...</div>
    
    <!-- Loading Indicator -->
    <div id="loading" class="loading">
        <div>‚è≥ Loading...</div>
    </div>

    <div class="container">
        <div class="header">
            <h1>üè• ‡¶´‡¶æ‡¶∞‡ßç‡¶Æ‡ßá‡¶∏‡ßÄ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ</h1>
            <p>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶´‡¶æ‡¶∞‡ßç‡¶Æ‡ßá‡¶∏‡ßÄ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡¶æ ‡¶∏‡¶π‡¶ú‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡¶∞‡¶ø‡¶ö‡¶æ‡¶≤‡¶®‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®</p>
        </div>

        <div class="nav-tabs">
            <button class="tab-button active" onclick="showTab('dashboard')">‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°</button>
            <button class="tab-button" onclick="showTab('products')">‡¶ì‡¶∑‡¶ß ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶™‡¶®‡¶æ</button>
            <button class="tab-button" onclick="showTab('sales')">‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶Ø‡¶º</button>
            <button class="tab-button" onclick="showTab('inventory')">‡¶∏‡ßç‡¶ü‡¶ï</button>
            <button class="tab-button" onclick="showTab('reports')">‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</button>
            <button class="tab-button" onclick="showTab('customer-reports')">‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</button>
        </div>

        <!-- Dashboard Tab -->
        <div class="tab-content">
            <div id="dashboard" class="tab-panel active">
                <h2>‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3 id="totalProducts">0</h3>
                        <p>‡¶Æ‡ßã‡¶ü ‡¶ì‡¶∑‡¶ß</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="totalSales">‡ß≥0</h3>
                        <p>‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶Ø‡¶º</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="lowStockCount">0</h3>
                        <p>‡¶ï‡¶Æ ‡¶∏‡ßç‡¶ü‡¶ï</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="expiredCount">0</h3>
                        <p>‡¶Æ‡ßá‡¶Ø‡¶º‡¶æ‡¶¶‡ßã‡¶§‡ßç‡¶§‡ßÄ‡¶∞‡ßç‡¶£</p>
                    </div>
                </div>

                <div id="alerts"></div>

                <h3>‡¶∏‡¶æ‡¶Æ‡ßç‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ï ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶Ø‡¶º</h3>
                <table class="table">
                    <thead>
                        <tr>
                            <th>‡¶¨‡¶ø‡¶≤ ‡¶®‡¶Ç</th>
                            <th>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th>
                            <th>‡¶Æ‡ßã‡¶ü</th>
                            <th>‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï</th>
                        </tr>
                    </thead>
                    <tbody id="recentSales">
                        <tr>
                            <td colspan="4" style="text-align: center; color: #666;">‡¶ï‡ßã‡¶® ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶Ø‡¶º ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶®‡ßá‡¶á</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Products Tab -->
            <div id="products" class="tab-panel">
                <h2>‡¶ì‡¶∑‡¶ß ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶™‡¶®‡¶æ</h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>‡¶ì‡¶∑‡¶ß‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ</label>
                        <input type="text" id="productName" placeholder="‡¶ì‡¶∑‡¶ß‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®">
                    </div>
                    <div class="form-group">
                        <label>‡¶ú‡ßá‡¶®‡ßá‡¶∞‡¶ø‡¶ï ‡¶®‡¶æ‡¶Æ</label>
                        <input type="text" id="genericName" placeholder="‡¶ú‡ßá‡¶®‡ßá‡¶∞‡¶ø‡¶ï ‡¶®‡¶æ‡¶Æ">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>‡¶ï‡ßã‡¶Æ‡ßç‡¶™‡¶æ‡¶®‡¶ø</label>
                        <input type="text" id="company" placeholder="‡¶ï‡ßã‡¶Æ‡ßç‡¶™‡¶æ‡¶®‡¶ø‡¶∞ ‡¶®‡¶æ‡¶Æ">
                    </div>
                    <div class="form-group">
                        <label>‡¶ï‡ßç‡¶∞‡¶Ø‡¶º‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø</label>
                        <input type="number" id="buyPrice" placeholder="‡¶ï‡ßç‡¶∞‡¶Ø‡¶º‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶Ø‡¶º‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø</label>
                        <input type="number" id="sellPrice" placeholder="‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶Ø‡¶º‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø">
                    </div>
                    <div class="form-group">
                        <label>‡¶∏‡ßç‡¶ü‡¶ï</label>
                        <input type="number" id="stock" placeholder="‡¶∏‡ßç‡¶ü‡¶ï ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>‡¶Æ‡ßá‡¶Ø‡¶º‡¶æ‡¶¶ ‡¶â‡¶§‡ßç‡¶§‡ßÄ‡¶∞‡ßç‡¶£‡ßá‡¶∞ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</label>
                        <input type="date" id="expiryDate">
                    </div>
                    <div class="form-group">
                        <label>‡¶á‡¶â‡¶®‡¶ø‡¶ü</label>
                        <select id="unit">
                            <option value="‡¶™‡¶ø‡¶∏">‡¶™‡¶ø‡¶∏</option>
                            <option value="‡¶¨‡ßã‡¶§‡¶≤">‡¶¨‡ßã‡¶§‡¶≤</option>
                            <option value="‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ü">‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ü</option>
                            <option value="‡¶™‡¶æ‡¶§‡¶æ">‡¶™‡¶æ‡¶§‡¶æ</option>
                        </select>
                    </div>
                </div>

                <button class="btn" onclick="addProduct()">‡¶ì‡¶∑‡¶ß ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                <button class="btn btn-success" onclick="updateProduct()" id="updateBtn" style="display: none;">‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>

                <input type="text" class="search-box" id="productSearch" placeholder="‡¶ì‡¶∑‡¶ß ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®..." oninput="searchProducts()">

                <table class="table">
                    <thead>
                        <tr>
                            <th>‡¶®‡¶æ‡¶Æ</th>
                            <th>‡¶ï‡ßã‡¶Æ‡ßç‡¶™‡¶æ‡¶®‡¶ø</th>
                            <th>‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶Ø‡¶º‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø</th>
                            <th>‡¶∏‡ßç‡¶ü‡¶ï</th>
                            <th>‡¶Æ‡ßá‡¶Ø‡¶º‡¶æ‡¶¶</th>
                            <th>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®</th>
                        </tr>
                    </thead>
                    <tbody id="productsTable"></tbody>
                </table>
            </div>

            <!-- Sales Tab -->
            <div id="sales" class="tab-panel">
                <h2>‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶Ø‡¶º</h2>
                
                <div class="sale-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label>‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ</label>
                            <input type="text" id="customerName" placeholder="‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ">
                        </div>
                        <div class="form-group">
                            <label>‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞</label>
                            <input type="text" id="customerPhone" placeholder="‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞">
                        </div>
                    </div>

                    <h3>‡¶ì‡¶∑‡¶ß ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶®</h3>
                    <div class="form-group" style="flex:2;"> 
                        <select id="saleProduct" onchange="updateSalePrice()">
                            <option value="">‡¶ì‡¶∑‡¶ß ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>
                        </select>
                        <input type="number" id="saleQuantity" placeholder="‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£" min="1" oninput="updateSalePrice()">
                        <input type="number" id="saleUnitPrice" placeholder="‡¶¶‡¶æ‡¶Æ" readonly>
                        <input type="number" id="saleTotal" placeholder="‡¶Æ‡ßã‡¶ü" readonly>
                        <button class="btn" onclick="addToSale()">‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                    </div>

                    <table class="table">
                        <thead>
                            <tr>
                                <th>‡¶ì‡¶∑‡¶ß</th>
                                <th>‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</th>
                                <th>‡¶¶‡¶æ‡¶Æ</th>
                                <th>‡¶Æ‡ßã‡¶ü</th>
                                <th>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®</th>
                            </tr>
                        </thead>
                        <tbody id="saleItems"></tbody>
                    </table>

                    <!-- Discount Section -->
                    <div class="discount-section">
                        <h4>üí∞ ‡¶õ‡¶æ‡¶°‡¶º ‡¶™‡ßç‡¶∞‡¶¶‡¶æ‡¶®</h4>
                        <div class="discount-row">
                            <div class="form-group">
                                <label>‡¶õ‡¶æ‡¶°‡¶º‡ßá‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ (%)</label>
                                <input type="number" id="discountPercent" placeholder="0" min="0" max="100" oninput="calculateDiscount()">
                            </div>
                            <div class="form-group">
                                <label>‡¶õ‡¶æ‡¶°‡¶º‡ßá‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ (‡ß≥)</label>
                                <input type="number" id="discountAmount" placeholder="0" readonly>
                            </div>
                            <div>
                                <button class="btn" onclick="applyDiscount()">‡¶õ‡¶æ‡¶°‡¶º ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                                <button class="btn btn-danger" onclick="clearDiscount()">‡¶õ‡¶æ‡¶°‡¶º ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button>
                            </div>
                        </div>
                    </div>

                    <div class="total-section">
                        <div class="total-breakdown">
                            <div>
                                <span>‡¶∏‡¶æ‡¶¨-‡¶ü‡ßã‡¶ü‡¶æ‡¶≤:</span>
                                <span>‡ß≥<span id="subTotal">0</span></span>
                            </div>
                            <div id="discountRow" style="display: none;">
                                <span>‡¶õ‡¶æ‡¶°‡¶º (<span id="appliedDiscountPercent">0</span>%):</span>
                                <span>- ‡ß≥<span id="appliedDiscountAmount">0</span></span>
                            </div>
                            <div class="final-total">
                                <span>‡¶∏‡¶∞‡ßç‡¶¨‡¶Æ‡ßã‡¶ü ‡¶¨‡¶ø‡¶≤:</span>
                                <span>‡ß≥<span id="grandTotal">0</span></span>
                            </div>
                        </div>
                        <button class="btn" onclick="completeSale()" style="background: white; color: #667eea; margin-top: 10px;">‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶Ø‡¶º ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                    </div>
                </div>
            </div>

            <!-- Inventory Tab -->
            <div id="inventory" class="tab-panel">
                <h2>‡¶∏‡ßç‡¶ü‡¶ï ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶™‡¶®‡¶æ</h2>
                
                <input type="text" class="search-box" id="inventorySearch" placeholder="‡¶ì‡¶∑‡¶ß ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®..." oninput="searchInventory()">

                <div class="form-row">
                    <button class="btn" onclick="showAllInventory()">‡¶∏‡¶ï‡¶≤ ‡¶∏‡ßç‡¶ü‡¶ï</button>
                    <button class="btn btn-danger" onclick="showLowStock()">‡¶ï‡¶Æ ‡¶∏‡ßç‡¶ü‡¶ï</button>
                    <button class="btn" onclick="showExpired()" style="background: linear-gradient(135deg, #ff9a56, #ffad56);">‡¶Æ‡ßá‡¶Ø‡¶º‡¶æ‡¶¶‡ßã‡¶§‡ßç‡¶§‡ßÄ‡¶∞‡ßç‡¶£</button>
                </div>

                <table class="table">
                    <thead>
                        <tr>
                            <th>‡¶ì‡¶∑‡¶ß</th>
                            <th>‡¶ï‡ßã‡¶Æ‡ßç‡¶™‡¶æ‡¶®‡¶ø</th>
                            <th>‡¶∏‡ßç‡¶ü‡¶ï</th>
                            <th>‡¶á‡¶â‡¶®‡¶ø‡¶ü</th>
                            <th>‡¶Æ‡ßá‡¶Ø‡¶º‡¶æ‡¶¶</th>
                            <th>‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ</th>
                        </tr>
                    </thead>
                    <tbody id="inventoryTable"></tbody>
                </table>
            </div>

            <!-- Reports Tab -->
            <div id="reports" class="tab-panel">
                <h2>‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</label>
                        <input type="date" id="startDate">
                    </div>
                    <div class="form-group">
                        <label>‡¶∂‡ßá‡¶∑ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</label>
                        <input type="date" id="endDate">
                    </div>
                    <div class="form-group">
                        <button class="btn" onclick="generateReport()">‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                    </div>
                </div>

                <div class="stats-grid" id="reportStats">
                    <div class="stat-card">
                        <h3 id="reportTotalSales">‡ß≥0</h3>
                        <p>‡¶Æ‡ßã‡¶ü ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶Ø‡¶º</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="reportTotalProfit">‡ß≥0</h3>
                        <p>‡¶Æ‡ßã‡¶ü ‡¶≤‡¶æ‡¶≠</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="reportTotalTransactions">0</h3>
                        <p>‡¶Æ‡ßã‡¶ü ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="reportAvgSale">‡ß≥0</h3>
                        <p>‡¶ó‡¶°‡¶º ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶Ø‡¶º</p>
                    </div>
                </div>

                <h3>‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶Ø‡¶º ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶°</h3>
                <table class="table">
                    <thead>
                        <tr>
                            <th>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th>
                            <th>‡¶¨‡¶ø‡¶≤ ‡¶®‡¶Ç</th>
                            <th>‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï</th>
                            <th>‡¶Æ‡ßã‡¶ü</th>
                            <th>‡¶≤‡¶æ‡¶≠</th>
                        </tr>
                    </thead>
                    <tbody id="reportTable"></tbody>
                </table>
            </div>

            <!-- Customer Reports Tab -->
            <div id="customer-reports" class="tab-panel">
                <h2>‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</h2>
                
                <div class="customer-search">
                    <input type="text" class="search-box" id="customerSearch" placeholder="‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶¨‡¶æ ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®..." oninput="searchCustomers()">
                </div>

                <div class="customer-list" id="customerList">
                    <div style="text-align: center; padding: 20px; color: #666;">
                        ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶ñ‡ßÅ‡¶Å‡¶ú‡¶§‡ßá ‡¶â‡¶™‡¶∞‡ßá‡¶∞ ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ‡¶¨‡¶ï‡ßç‡¶∏‡ßá ‡¶®‡¶æ‡¶Æ ‡¶¨‡¶æ ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®
                    </div>
                </div>

                <div id="selectedCustomerReport" style="display: none;">
                    <div class="customer-report">
                        <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 20px;">
                            <h3 id="customerReportTitle">‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï‡ßá‡¶∞ ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</h3>
                            <button class="btn" onclick="printCustomerReport()">üñ®Ô∏è ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                        </div>
                        
                        <div class="stats-grid">
                            <div class="stat-card">
                                <h3 id="customerTotalPurchase">‡ß≥0</h3>
                                <p>‡¶Æ‡ßã‡¶ü ‡¶ï‡ßá‡¶®‡¶æ‡¶ï‡¶æ‡¶ü‡¶æ</p>
                            </div>
                            <div class="stat-card">
                                <h3 id="customerTotalVisits">0</h3>
                                <p>‡¶Æ‡ßã‡¶ü ‡¶≠‡¶ø‡¶ú‡¶ø‡¶ü</p>
                            </div>
                            <div class="stat-card">
                                <h3 id="customerAvgPurchase">‡ß≥0</h3>
                                <p>‡¶ó‡¶°‡¶º ‡¶ï‡ßá‡¶®‡¶æ‡¶ï‡¶æ‡¶ü‡¶æ</p>
                            </div>
                            <div class="stat-card">
                                <h3 id="customerLastVisit">-</h3>
                                <p>‡¶∂‡ßá‡¶∑ ‡¶≠‡¶ø‡¶ú‡¶ø‡¶ü</p>
                            </div>
                        </div>

                        <h4>‡¶ï‡ßç‡¶∞‡¶Ø‡¶º‡ßá‡¶∞ ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏</h4>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th>
                                    <th>‡¶¨‡¶ø‡¶≤ ‡¶®‡¶Ç</th>
                                    <th>‡¶ì‡¶∑‡¶ß‡¶∏‡¶Æ‡ßÇ‡¶π</th>
                                    <th>‡¶Æ‡ßã‡¶ü</th>
                                </tr>
                            </thead>
                            <tbody id="customerPurchaseHistory"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Print Area -->
    <div class="print-area">
        <div id="printContent"></div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
        import { getDatabase, ref, set, get, push, remove, onValue, off } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-database.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-analytics.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAulRy_pn5v-Ui7YEH6A2N6qVdd0bInl-c",
            authDomain: "tonmoy-pharmacy.firebaseapp.com",
            databaseURL: "https://tonmoy-pharmacy-default-rtdb.firebaseio.com",
            projectId: "tonmoy-pharmacy",
            storageBucket: "tonmoy-pharmacy.firebasestorage.app",
            messagingSenderId: "290255187321",
            appId: "1:290255187321:web:66b6c66a9b6e335dd593a8",
            measurementId: "G-SGM6QKY5J1"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const database = getDatabase(app);

        // Global variables
        let products = {};
        let sales = {};
        let currentSaleItems = [];
        let editingProductId = null;
        let currentDiscount = { percent: 0, amount: 0 };
        let isConnected = false;

        // Firebase connection status
        const connectedRef = ref(database, '.info/connected');
        onValue(connectedRef, (snapshot) => {
            const connected = snapshot.val();
            const statusElement = document.getElementById('connectionStatus');
            if (connected) {
                isConnected = true;
                statusElement.textContent = 'üü¢ Connected to Firebase';
                statusElement.className = 'connection-status connected';
                loadAllData();
            } else {
                isConnected = false;
                statusElement.textContent = 'üî¥ Disconnected';
                statusElement.className = 'connection-status disconnected';
            }
        });

        // Load all data from Firebase
        async function loadAllData() {
            showLoading(true);
            try {
                // Load products
                const productsSnapshot = await get(ref(database, 'products'));
                products = productsSnapshot.val() || {};
                
                // Load sales
                const salesSnapshot = await get(ref(database, 'sales'));
                sales = salesSnapshot.val() || {};

                // Update UI
                updateDashboard();
                loadProductsTable();
                loadSaleProductOptions();
                loadInventoryTable();
                
                // Set today's date for reports
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('startDate').value = today;
                document.getElementById('endDate').value = today;
            } catch (error) {
                console.error('Error loading data:', error);
                showAlert('‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'warning');
            } finally {
                showLoading(false);
            }
        }

        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }

        // Firebase save functions
        async function saveProduct(product) {
            if (!isConnected) {
                showAlert('‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶®‡ßá‡¶á', 'warning');
                return false;
            }
            
            try {
                if (product.id) {
                    await set(ref(database, 'products/' + product.id), product);
                    products[product.id] = product;
                } else {
                    const newProductRef = push(ref(database, 'products'));
                    product.id = newProductRef.key;
                    await set(newProductRef, product);
                    products[product.id] = product;
                }
                return true;
            } catch (error) {
                console.error('Error saving product:', error);
                showAlert('‡¶ì‡¶∑‡¶ß ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'warning');
                return false;
            }
        }

        async function deleteProductFromFirebase(productId) {
            if (!isConnected) {
                showAlert('‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶®‡ßá‡¶á', 'warning');
                return false;
            }

            try {
                await remove(ref(database, 'products/' + productId));
                delete products[productId];
                return true;
            } catch (error) {
                console.error('Error deleting product:', error);
                showAlert('‡¶ì‡¶∑‡¶ß ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'warning');
                return false;
            }
        }

        async function saveSale(sale) {
            if (!isConnected) {
                showAlert('‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶®‡ßá‡¶á', 'warning');
                return false;
            }

            try {
                const newSaleRef = push(ref(database, 'sales'));
                sale.id = sale.id || newSaleRef.key;
                await set(newSaleRef, sale);
                sales[sale.id] = sale;
                return true;
            } catch (error) {
                console.error('Error saving sale:', error);
                showAlert('‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶Ø‡¶º ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'warning');
                return false;
            }
        }

        // Tab Management
        function showTab(tabName) {
            // Hide all panels
            const panels = document.querySelectorAll('.tab-panel');
            panels.forEach(panel => panel.classList.remove('active'));
            
            // Remove active class from all buttons
            const buttons = document.querySelectorAll('.tab-button');
            buttons.forEach(button => button.classList.remove('active'));
            
            // Show selected panel and activate button
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            // Refresh data based on tab
            if (tabName === 'dashboard') {
                updateDashboard();
            } else if (tabName === 'inventory') {
                loadInventoryTable();
            } else if (tabName === 'customer-reports') {
                loadCustomersList();
            }
        }

        // Product Management
        async function addProduct() {
            const name = document.getElementById('productName').value.trim();
            const generic = document.getElementById('genericName').value.trim();
            const company = document.getElementById('company').value.trim();
            const buyPrice = parseFloat(document.getElementById('buyPrice').value);
            const sellPrice = parseFloat(document.getElementById('sellPrice').value);
            const stock = parseInt(document.getElementById('stock').value);
            const expiryDate = document.getElementById('expiryDate').value;
            const unit = document.getElementById('unit').value;

            if (!name || !company || !buyPrice || !sellPrice || !stock || !expiryDate) {
                alert('‡¶∏‡¶¨ ‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡¶†‡¶ø‡¶ï‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®');
                return;
            }

            if (sellPrice < buyPrice) {
                alert('‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶Ø‡¶º‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø ‡¶ï‡ßç‡¶∞‡¶Ø‡¶º‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø‡ßá‡¶∞ ‡¶ö‡ßá‡¶Ø‡¶º‡ßá ‡¶ï‡¶Æ ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá ‡¶®‡¶æ');
                return;
            }

            const product = {
                id: Date.now().toString(),
                name,
                generic,
                company,
                buyPrice,
                sellPrice,
                stock,
                expiryDate,
                unit,
                addedDate: new Date().toISOString()
            };

            const success = await saveProduct(product);
            if (success) {
                loadProductsTable();
                loadSaleProductOptions();
                clearProductForm();
                updateDashboard();
                showAlert('‡¶ì‡¶∑‡¶ß ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'success');
            }
        }

        function editProduct(id) {
            const product = products[id];
            if (!product) return;

            document.getElementById('productName').value = product.name;
            document.getElementById('genericName').value = product.generic || '';
            document.getElementById('company').value = product.company;
            document.getElementById('buyPrice').value = product.buyPrice;
            document.getElementById('sellPrice').value = product.sellPrice;
            document.getElementById('stock').value = product.stock;
            document.getElementById('expiryDate').value = product.expiryDate;
            document.getElementById('unit').value = product.unit;

            editingProductId = id;
            document.getElementById('updateBtn').style.display = 'inline-block';
        }

        async function updateProduct() {
            if (!editingProductId) return;

            const name = document.getElementById('productName').value.trim();
            const generic = document.getElementById('genericName').value.trim();
            const company = document.getElementById('company').value.trim();
            const buyPrice = parseFloat(document.getElementById('buyPrice').value);
            const sellPrice = parseFloat(document.getElementById('sellPrice').value);
            const stock = parseInt(document.getElementById('stock').value);
            const expiryDate = document.getElementById('expiryDate').value;
            const unit = document.getElementById('unit').value;

            if (!name || !company || !buyPrice || !sellPrice || !stock || !expiryDate) {
                alert('‡¶∏‡¶¨ ‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡¶†‡¶ø‡¶ï‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®');
                return;
            }

            const product = {
                ...products[editingProductId],
                name,
                generic,
                company,
                buyPrice,
                sellPrice,
                stock,
                expiryDate,
                unit
            };

            const success = await saveProduct(product);
            if (success) {
                loadProductsTable();
                loadSaleProductOptions();
                clearProductForm();
                updateDashboard();
                showAlert('‡¶ì‡¶∑‡¶ß ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'success');
            }

            editingProductId = null;
            document.getElementById('updateBtn').style.display = 'none';
        }

        async function deleteProduct(id) {
            if (confirm('‡¶è‡¶á ‡¶ì‡¶∑‡¶ß‡¶ü‡¶ø ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')) {
                const success = await deleteProductFromFirebase(id);
                if (success) {
                    loadProductsTable();
                    loadSaleProductOptions();
                    updateDashboard();
                    showAlert('‡¶ì‡¶∑‡¶ß ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'success');
                }
            }
        }

        function clearProductForm() {
            document.getElementById('productName').value = '';
            document.getElementById('genericName').value = '';
            document.getElementById('company').value = '';
            document.getElementById('buyPrice').value = '';
            document.getElementById('sellPrice').value = '';
            document.getElementById('stock').value = '';
            document.getElementById('expiryDate').value = '';
            document.getElementById('unit').value = '‡¶™‡¶ø‡¶∏';
        }

        function loadProductsTable() {
            const tbody = document.getElementById('productsTable');
            tbody.innerHTML = '';

            Object.values(products).forEach(product => {
                const isLowStock = product.stock <= 10;
                const isExpired = new Date(product.expiryDate) < new Date();
                
                const row = document.createElement('tr');
                if (isLowStock) row.classList.add('low-stock');
                if (isExpired) row.classList.add('expired');
                
                row.innerHTML = `
                    <td>${product.name}</td>
                    <td>${product.company}</td>
                    <td>‡ß≥${product.sellPrice}</td>
                    <td>${product.stock} ${product.unit}</td>
                    <td>${formatDate(product.expiryDate)}</td>
                    <td>
                        <button class="btn" onclick="editProduct('${product.id}')">‡¶∏‡¶Æ‡ßç‡¶™‡¶æ‡¶¶‡¶®‡¶æ</button>
                        <button class="btn btn-danger" onclick="deleteProduct('${product.id}')">‡¶°‡¶ø‡¶≤‡¶ø‡¶ü</button>
                    </td>
                `;
                tbody.appendChild(row);
            });

            if (Object.keys(products).length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #666;">‡¶ï‡ßã‡¶® ‡¶ì‡¶∑‡¶ß ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø</td></tr>';
            }
        }

        function searchProducts() {
            const searchTerm = document.getElementById('productSearch').value.toLowerCase();
            const tbody = document.getElementById('productsTable');
            const rows = tbody.querySelectorAll('tr');

            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        // Sales Management
        function loadSaleProductOptions() {
            const select = document.getElementById('saleProduct');
            select.innerHTML = '<option value="">‡¶ì‡¶∑‡¶ß ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>';

            Object.values(products).forEach(product => {
                if (product.stock > 0 && new Date(product.expiryDate) > new Date()) {
                    const option = document.createElement('option');
                    option.value = product.id;
                    option.textContent = `${product.name} - ${product.company} (${product.stock} ${product.unit})`;
                    select.appendChild(option);
                }
            });
        }

        function updateSalePrice() {
            const productId = document.getElementById('saleProduct').value;
            const quantity = parseInt(document.getElementById('saleQuantity').value) || 0;
            
            if (productId) {
                const product = products[productId];
                if (product) {
                    document.getElementById('saleUnitPrice').value = product.sellPrice;
                    document.getElementById('saleTotal').value = product.sellPrice * quantity;
                }
            } else {
                document.getElementById('saleUnitPrice').value = '';
                document.getElementById('saleTotal').value = '';
            }
        }

        function addToSale() {
            const productId = document.getElementById('saleProduct').value;
            const quantity = parseInt(document.getElementById('saleQuantity').value);
            
            if (!productId || !quantity || quantity <= 0) {
                alert('‡¶ì‡¶∑‡¶ß ‡¶ì ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶∏‡¶†‡¶ø‡¶ï‡¶≠‡¶æ‡¶¨‡ßá ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®');
                return;
            }

            const product = products[productId];
            if (!product) return;

            if (quantity > product.stock) {
                alert('‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶§ ‡¶∏‡ßç‡¶ü‡¶ï ‡¶®‡ßá‡¶á');
                return;
            }

            // Check if product already in sale
            const existingItemIndex = currentSaleItems.findIndex(item => item.productId === productId);
            
            if (existingItemIndex !== -1) {
                currentSaleItems[existingItemIndex].quantity += quantity;
                currentSaleItems[existingItemIndex].total = currentSaleItems[existingItemIndex].quantity * product.sellPrice;
            } else {
                currentSaleItems.push({
                    productId: productId,
                    name: product.name,
                    company: product.company,
                    quantity: quantity,
                    unitPrice: product.sellPrice,
                    buyPrice: product.buyPrice,
                    total: quantity * product.sellPrice
                });
            }

            loadSaleItemsTable();
            clearSaleForm();
            calculateTotals();
        }

        function loadSaleItemsTable() {
            const tbody = document.getElementById('saleItems');
            tbody.innerHTML = '';

            currentSaleItems.forEach((item, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.name} - ${item.company}</td>
                    <td>${item.quantity}</td>
                    <td>‡ß≥${item.unitPrice}</td>
                    <td>‡ß≥${item.total}</td>
                    <td>
                        <button class="btn btn-danger" onclick="removeFromSale(${index})">‡¶∏‡¶∞‡¶æ‡¶®</button>
                    </td>
                `;
                tbody.appendChild(row);
            });

            if (currentSaleItems.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #666;">‡¶ï‡ßã‡¶® ‡¶™‡¶£‡ßç‡¶Ø ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶ø‡¶§ ‡¶®‡ßá‡¶á</td></tr>';
            }
        }

        function removeFromSale(index) {
            currentSaleItems.splice(index, 1);
            loadSaleItemsTable();
            calculateTotals();
        }

        function clearSaleForm() {
            document.getElementById('saleProduct').value = '';
            document.getElementById('saleQuantity').value = '';
            document.getElementById('saleUnitPrice').value = '';
            document.getElementById('saleTotal').value = '';
        }

        // Discount Functions
        function calculateDiscount() {
            const discountPercent = parseFloat(document.getElementById('discountPercent').value) || 0;
            const subTotal = currentSaleItems.reduce((sum, item) => sum + item.total, 0);
            const discountAmount = (subTotal * discountPercent) / 100;
            
            document.getElementById('discountAmount').value = discountAmount.toFixed(2);
        }

        function applyDiscount() {
            const discountPercent = parseFloat(document.getElementById('discountPercent').value) || 0;
            const discountAmount = parseFloat(document.getElementById('discountAmount').value) || 0;

            if (discountPercent < 0 || discountPercent > 100) {
                alert('‡¶õ‡¶æ‡¶°‡¶º‡ßá‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡ß¶-‡ßß‡ß¶‡ß¶% ‡¶è‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá');
                return;
            }

            currentDiscount = { percent: discountPercent, amount: discountAmount };
            calculateTotals();
            showAlert('‡¶õ‡¶æ‡¶°‡¶º ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'success');
        }

        function clearDiscount() {
            document.getElementById('discountPercent').value = '';
            document.getElementById('discountAmount').value = '';
            currentDiscount = { percent: 0, amount: 0 };
            calculateTotals();
            showAlert('‡¶õ‡¶æ‡¶°‡¶º ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'success');
        }

        function calculateTotals() {
            const subTotal = currentSaleItems.reduce((sum, item) => sum + item.total, 0);
            const finalTotal = subTotal - currentDiscount.amount;

            document.getElementById('subTotal').textContent = subTotal;
            document.getElementById('grandTotal').textContent = finalTotal;

            if (currentDiscount.amount > 0) {
                document.getElementById('discountRow').style.display = 'block';
                document.getElementById('appliedDiscountPercent').textContent = currentDiscount.percent;
                document.getElementById('appliedDiscountAmount').textContent = currentDiscount.amount.toFixed(2);
            } else {
                document.getElementById('discountRow').style.display = 'none';
            }
        }

        async function completeSale() {
            if (currentSaleItems.length === 0) {
                alert('‡¶ï‡ßã‡¶® ‡¶™‡¶£‡ßç‡¶Ø ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶ø‡¶§ ‡¶®‡ßá‡¶á');
                return;
            }

            const customerName = document.getElementById('customerName').value.trim() || '‡¶®‡¶æ‡¶Æ ‡¶®‡ßá‡¶á';
            const customerPhone = document.getElementById('customerPhone').value.trim() || '';

            const saleId = 'BILL-' + Date.now();
            const saleDate = new Date().toISOString();
            const subTotal = currentSaleItems.reduce((sum, item) => sum + item.total, 0);
            const finalTotal = subTotal - currentDiscount.amount;
            let totalProfit = 0;

            // Update stock and calculate totals
            for (const item of currentSaleItems) {
                const product = products[item.productId];
                if (product) {
                    product.stock -= item.quantity;
                    await saveProduct(product);
                    totalProfit += (item.unitPrice - item.buyPrice) * item.quantity;
                }
            }

            const sale = {
                id: saleId,
                date: saleDate,
                customer: customerName,
                phone: customerPhone,
                items: [...currentSaleItems],
                subTotal: subTotal,
                discount: currentDiscount,
                totalAmount: finalTotal,
                totalProfit: totalProfit - currentDiscount.amount
            };

            const success = await saveSale(sale);
            if (success) {
                // Clear sale form
                currentSaleItems = [];
                currentDiscount = { percent: 0, amount: 0 };
                document.getElementById('customerName').value = '';
                document.getElementById('customerPhone').value = '';
                clearDiscount();
                loadSaleItemsTable();
                calculateTotals();
                updateDashboard();

                alert(`‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶Ø‡¶º ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!\n‡¶¨‡¶ø‡¶≤ ‡¶®‡¶Ç: ${saleId}\n‡¶∏‡¶æ‡¶¨-‡¶ü‡ßã‡¶ü‡¶æ‡¶≤: ‡ß≥${subTotal}\n‡¶õ‡¶æ‡¶°‡¶º: ‡ß≥${currentDiscount.amount}\n‡¶∏‡¶∞‡ßç‡¶¨‡¶Æ‡ßã‡¶ü: ‡ß≥${finalTotal}`);
            }
        }

        // Make functions global
        window.showTab = showTab;
        window.addProduct = addProduct;
        window.editProduct = editProduct;
        window.updateProduct = updateProduct;
        window.deleteProduct = deleteProduct;
        window.searchProducts = searchProducts;
        window.updateSalePrice = updateSalePrice;
        window.addToSale = addToSale;
        window.removeFromSale = removeFromSale;
        window.calculateDiscount = calculateDiscount;
        window.applyDiscount = applyDiscount;
        window.clearDiscount = clearDiscount;
        window.completeSale = completeSale;

        // Inventory Management
        function loadInventoryTable() {
            const tbody = document.getElementById('inventoryTable');
            tbody.innerHTML = '';

            Object.values(products).forEach(product => {
                const isLowStock = product.stock <= 10;
                const isExpired = new Date(product.expiryDate) < new Date();
                
                let status = '‡¶∏‡ßç‡¶¨‡¶æ‡¶≠‡¶æ‡¶¨‡¶ø‡¶ï';
                let statusClass = 'stock';
                
                if (isExpired) {
                    status = '‡¶Æ‡ßá‡¶Ø‡¶º‡¶æ‡¶¶‡ßã‡¶§‡ßç‡¶§‡ßÄ‡¶∞‡ßç‡¶£';
                    statusClass = 'expired';
                } else if (isLowStock) {
                    status = '‡¶ï‡¶Æ ‡¶∏‡ßç‡¶ü‡¶ï';
                    statusClass = 'low-stock';
                }
                
                const row = document.createElement('tr');
                row.classList.add(statusClass);
                
                row.innerHTML = `
                    <td>${product.name}</td>
                    <td>${product.company}</td>
                    <td>${product.stock}</td>
                    <td>${product.unit}</td>
                    <td>${formatDate(product.expiryDate)}</td>
                    <td>${status}</td>
                `;
                tbody.appendChild(row);
            });

            if (Object.keys(products).length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #666;">‡¶ï‡ßã‡¶® ‡¶™‡¶£‡ßç‡¶Ø ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø</td></tr>';
            }
        }

        function searchInventory() {
            const searchTerm = document.getElementById('inventorySearch').value.toLowerCase();
            const tbody = document.getElementById('inventoryTable');
            const rows = tbody.querySelectorAll('tr');

            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        function showAllInventory() {
            loadInventoryTable();
        }

        function showLowStock() {
            const tbody = document.getElementById('inventoryTable');
            tbody.innerHTML = '';

            const lowStockProducts = Object.values(products).filter(p => p.stock <= 10);

            lowStockProducts.forEach(product => {
                const row = document.createElement('tr');
                row.classList.add('low-stock');
                
                row.innerHTML = `
                    <td>${product.name}</td>
                    <td>${product.company}</td>
                    <td>${product.stock}</td>
                    <td>${product.unit}</td>
                    <td>${formatDate(product.expiryDate)}</td>
                    <td>‡¶ï‡¶Æ ‡¶∏‡ßç‡¶ü‡¶ï</td>
                `;
                tbody.appendChild(row);
            });

            if (lowStockProducts.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #666;">‡¶ï‡¶Æ ‡¶∏‡ßç‡¶ü‡¶ï ‡¶ï‡ßã‡¶® ‡¶™‡¶£‡ßç‡¶Ø ‡¶®‡ßá‡¶á</td></tr>';
            }
        }

function showExpired() {
    const tbody = document.getElementById('inventoryTable');
    tbody.innerHTML = '';

    const today = new Date();
    const sixtyDaysLater = new Date();
    sixtyDaysLater.setDate(today.getDate() + 60);

    const expiredProducts = Object.values(products).filter(p => {
        const expiryDate = new Date(p.expiryDate);
        return expiryDate <= sixtyDaysLater; // ‡¶Ü‡¶ú ‡¶•‡ßá‡¶ï‡ßá ‡ß¨‡ß¶ ‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶≠‡ßá‡¶§‡¶∞‡ßá
    });

    expiredProducts.forEach(product => {
        const expiryDate = new Date(product.expiryDate);
        const diffTime = expiryDate - today;
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); // ‡¶ï‡¶§‡¶¶‡¶ø‡¶® ‡¶¨‡¶æ‡¶ï‡¶ø ‡¶Ü‡¶õ‡ßá

        let statusText = '';
        if (diffDays < 0) {
            statusText = '‡¶Æ‡ßá‡¶Ø‡¶º‡¶æ‡¶¶ ‡¶∂‡ßá‡¶∑';
        } else {
            statusText = diffDays + ' ‡¶¶‡¶ø‡¶® ‡¶¨‡¶æ‡¶ï‡¶ø';
        }

        const row = document.createElement('tr');
        row.classList.add('expired');
        
        row.innerHTML = `
            <td>${product.name}</td>
            <td>${product.company}</td>
            <td>${product.stock}</td>
            <td>${product.unit}</td>
            <td>${formatDate(product.expiryDate)}</td>
            <td>${statusText}</td>
        `;
        tbody.appendChild(row);
    });

    if (expiredProducts.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #666;">‡¶Æ‡ßá‡¶Ø‡¶º‡¶æ‡¶¶‡ßã‡¶§‡ßç‡¶§‡ßÄ‡¶∞‡ßç‡¶£ ‡¶ï‡ßã‡¶® ‡¶™‡¶£‡ßç‡¶Ø ‡¶®‡ßá‡¶á</td></tr>';
    }
}


        // Make inventory functions global
        window.loadInventoryTable = loadInventoryTable;
        window.searchInventory = searchInventory;
        window.showAllInventory = showAllInventory;
        window.showLowStock = showLowStock;
        window.showExpired = showExpired;

        // Customer Reports
        function loadCustomersList() {
            const customerList = document.getElementById('customerList');
            customerList.innerHTML = '<div style="text-align: center; padding: 20px; color: #666;">‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶ñ‡ßÅ‡¶Å‡¶ú‡¶§‡ßá ‡¶â‡¶™‡¶∞‡ßá‡¶∞ ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ‡¶¨‡¶ï‡ßç‡¶∏‡ßá ‡¶®‡¶æ‡¶Æ ‡¶¨‡¶æ ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®</div>';
        }

        function searchCustomers() {
            const searchTerm = document.getElementById('customerSearch').value.toLowerCase().trim();
            const customerList = document.getElementById('customerList');
            
            if (searchTerm.length < 2) {
                customerList.innerHTML = '<div style="text-align: center; padding: 20px; color: #666;">‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡ß®‡¶ü‡¶ø ‡¶Ö‡¶ï‡ßç‡¶∑‡¶∞ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®</div>';
                return;
            }

            // Get unique customers
            const customers = {};
            Object.values(sales).forEach(sale => {
                const key = sale.customer.toLowerCase() + '_' + sale.phone;
                if (sale.customer.toLowerCase().includes(searchTerm) || sale.phone.includes(searchTerm)) {
                    if (!customers[key]) {
                        customers[key] = {
                            name: sale.customer,
                            phone: sale.phone,
                            sales: []
                        };
                    }
                    customers[key].sales.push(sale);
                }
            });

            customerList.innerHTML = '';
            
            Object.values(customers).forEach(customer => {
                const totalPurchase = customer.sales.reduce((sum, sale) => sum + sale.totalAmount, 0);
                const lastVisit = new Date(Math.max(...customer.sales.map(s => new Date(s.date))));
                
                const customerDiv = document.createElement('div');
                customerDiv.className = 'customer-item';
                customerDiv.innerHTML = `
                    <strong>${customer.name}</strong>
                    ${customer.phone ? `<br>üìû ${customer.phone}` : ''}
                    <br><small>‡¶Æ‡ßã‡¶ü ‡¶ï‡ßá‡¶®‡¶æ‡¶ï‡¶æ‡¶ü‡¶æ: ‡ß≥${totalPurchase} | ‡¶≠‡¶ø‡¶ú‡¶ø‡¶ü: ${customer.sales.length}‡¶ü‡¶ø | ‡¶∂‡ßá‡¶∑: ${formatDate(lastVisit.toISOString())}</small>
                `;
                customerDiv.onclick = () => showCustomerReport(customer);
                customerList.appendChild(customerDiv);
            });

            if (Object.keys(customers).length === 0) {
                customerList.innerHTML = '<div style="text-align: center; padding: 20px; color: #666;">‡¶ï‡ßã‡¶® ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø</div>';
            }
        }

        function showCustomerReport(customer) {
            const reportDiv = document.getElementById('selectedCustomerReport');
            const titleDiv = document.getElementById('customerReportTitle');
            
            titleDiv.textContent = `${customer.name} ‡¶è‡¶∞ ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü`;
            
            // Calculate statistics
            const totalPurchase = customer.sales.reduce((sum, sale) => sum + sale.totalAmount, 0);
            const totalVisits = customer.sales.length;
            const avgPurchase = totalPurchase / totalVisits;
            const lastVisit = new Date(Math.max(...customer.sales.map(s => new Date(s.date))));

            document.getElementById('customerTotalPurchase').textContent = '‡ß≥' + totalPurchase;
            document.getElementById('customerTotalVisits').textContent = totalVisits;
            document.getElementById('customerAvgPurchase').textContent = '‡ß≥' + Math.round(avgPurchase);
            document.getElementById('customerLastVisit').textContent = formatDate(lastVisit.toISOString());

            // Load purchase history
            const tbody = document.getElementById('customerPurchaseHistory');
            tbody.innerHTML = '';

            customer.sales.sort((a, b) => new Date(b.date) - new Date(a.date)).forEach(sale => {
                const medicines = sale.items.map(item => `${item.name}`).join(', ');
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${formatDateTime(sale.date)}</td>
                    <td>${sale.id}</td>
                    <td>${medicines}</td>
                    <td>‡ß≥${sale.totalAmount}</td>
                `;
                tbody.appendChild(row);
            });

            reportDiv.style.display = 'block';
        }

        function printCustomerReport() {
            const customerName = document.getElementById('customerReportTitle').textContent;
            const totalPurchase = document.getElementById('customerTotalPurchase').textContent;
            const totalVisits = document.getElementById('customerTotalVisits').textContent;
            const avgPurchase = document.getElementById('customerAvgPurchase').textContent;
            const lastVisit = document.getElementById('customerLastVisit').textContent;
            
            const purchaseHistoryTable = document.getElementById('customerPurchaseHistory').outerHTML;

            const printContent = `
                <div style="font-family: Arial, sans-serif; padding: 20px;">
                    <div style="text-align: center; margin-bottom: 30px;">
                        <h1>üè• ‡¶§‡¶®‡ßç‡¶Æ‡ßü ‡¶´‡¶æ‡¶∞‡ßç‡¶Æ‡ßá‡¶∏‡ßÄ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ</h1>
                        <h2>${customerName}</h2>
                        <p>‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ: ${formatDateTime(new Date().toISOString())}</p>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px;">
                        <div style="text-align: center; padding: 15px; border: 2px solid #667eea; border-radius: 8px;">
                            <h3>${totalPurchase}</h3>
                            <p>‡¶Æ‡ßã‡¶ü ‡¶ï‡ßá‡¶®‡¶æ‡¶ï‡¶æ‡¶ü‡¶æ</p>
                        </div>
                        <div style="text-align: center; padding: 15px; border: 2px solid #4ecdc4; border-radius: 8px;">
                            <h3>${totalVisits}</h3>
                            <p>‡¶Æ‡ßã‡¶ü ‡¶≠‡¶ø‡¶ú‡¶ø‡¶ü</p>
                        </div>
                        <div style="text-align: center; padding: 15px; border: 2px solid #45b7d1; border-radius: 8px;">
                            <h3>${avgPurchase}</h3>
                            <p>‡¶ó‡¶°‡¶º ‡¶ï‡ßá‡¶®‡¶æ‡¶ï‡¶æ‡¶ü‡¶æ</p>
                        </div>
                        <div style="text-align: center; padding: 15px; border: 2px solid #f093fb; border-radius: 8px;">
                            <h3>${lastVisit}</h3>
                            <p>‡¶∂‡ßá‡¶∑ ‡¶≠‡¶ø‡¶ú‡¶ø‡¶ü</p>
                        </div>
                    </div>
                    
                    <h3>‡¶ï‡ßç‡¶∞‡¶Ø‡¶º‡ßá‡¶∞ ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏</h3>
                    <table style="width: 100%; border-collapse: collapse; border: 1px solid #ddd;">
                        ${purchaseHistoryTable.replace('<tbody id="customerPurchaseHistory">', '<tbody>').replace(/onclick="[^"]*"/g, '')}
                    </table>
                </div>
            `;

            document.getElementById('printContent').innerHTML = printContent;
            window.print();
        }

        // Make customer functions global
        window.loadCustomersList = loadCustomersList;
        window.searchCustomers = searchCustomers;
        window.showCustomerReport = showCustomerReport;
        window.printCustomerReport = printCustomerReport;

        // Dashboard
        function updateDashboard() {
            // Update statistics
            document.getElementById('totalProducts').textContent = Object.keys(products).length;
            
            const today = new Date().toDateString();
            const todaySales = Object.values(sales).filter(sale => new Date(sale.date).toDateString() === today);
            const todayTotal = todaySales.reduce((sum, sale) => sum + sale.totalAmount, 0);
            document.getElementById('totalSales').textContent = '‡ß≥' + todayTotal;

            const lowStockCount = Object.values(products).filter(p => p.stock <= 10).length;
            document.getElementById('lowStockCount').textContent = lowStockCount;

            const expiredCount = Object.values(products).filter(p => new Date(p.expiryDate) < new Date()).length;
            document.getElementById('expiredCount').textContent = expiredCount;

            // Show alerts
            showDashboardAlerts();

            // Load recent sales
            loadRecentSales();
        }

        function showDashboardAlerts() {
            const alertsDiv = document.getElementById('alerts');
            alertsDiv.innerHTML = '';

            const lowStockProducts = Object.values(products).filter(p => p.stock <= 10);
            const expiredProducts = Object.values(products).filter(p => new Date(p.expiryDate) < new Date());

            if (expiredProducts.length > 0) {
                const alert = document.createElement('div');
                alert.className = 'alert alert-warning';
                alert.innerHTML = `<strong>‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶§‡¶æ!</strong> ${expiredProducts.length}‡¶ü‡¶ø ‡¶ì‡¶∑‡¶ß‡ßá‡¶∞ ‡¶Æ‡ßá‡¶Ø‡¶º‡¶æ‡¶¶ ‡¶∂‡ßá‡¶∑ ‡¶π‡¶Ø‡¶º‡ßá ‡¶ó‡ßá‡¶õ‡ßá‡•§`;
                alertsDiv.appendChild(alert);
            }

            if (lowStockProducts.length > 0) {
                const alert = document.createElement('div');
                alert.className = 'alert alert-warning';
                alert.innerHTML = `<strong>‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶§‡¶æ!</strong> ${lowStockProducts.length}‡¶ü‡¶ø ‡¶ì‡¶∑‡¶ß‡ßá‡¶∞ ‡¶∏‡ßç‡¶ü‡¶ï ‡¶ï‡¶Æ‡•§`;
                alertsDiv.appendChild(alert);
            }
        }

        function loadRecentSales() {
            const tbody = document.getElementById('recentSales');
            tbody.innerHTML = '';

            const recentSales = Object.values(sales).slice(-5).reverse(); // Last 5 sales

            recentSales.forEach(sale => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${sale.id}</td>
                    <td>${formatDateTime(sale.date)}</td>
                    <td>‡ß≥${sale.totalAmount}</td>
                    <td>${sale.customer}</td>
                `;
                tbody.appendChild(row);
            });

            if (recentSales.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" style="text-align: center; color: #666;">‡¶ï‡ßã‡¶® ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶Ø‡¶º ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶®‡ßá‡¶á</td></tr>';
            }
        }

        // Make dashboard functions global
        window.updateDashboard = updateDashboard;

        // Reports
        function generateReport() {
            const startDate = new Date(document.getElementById('startDate').value);
            const endDate = new Date(document.getElementById('endDate').value);
            
            if (startDate > endDate) {
                alert('‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ ‡¶∂‡ßá‡¶∑ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ‡ßá‡¶∞ ‡¶™‡¶∞‡ßá ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá ‡¶®‡¶æ');
                return;
            }

            const filteredSales = Object.values(sales).filter(sale => {
                const saleDate = new Date(sale.date);
                return saleDate >= startDate && saleDate <= endDate;
            });

            const totalSales = filteredSales.reduce((sum, sale) => sum + sale.totalAmount, 0);
            const totalProfit = filteredSales.reduce((sum, sale) => sum + sale.totalProfit, 0);
            const totalTransactions = filteredSales.length;
            const avgSale = totalTransactions > 0 ? totalSales / totalTransactions : 0;

            document.getElementById('reportTotalSales').textContent = '‡ß≥' + totalSales;
            document.getElementById('reportTotalProfit').textContent = '‡ß≥' + totalProfit;
            document.getElementById('reportTotalTransactions').textContent = totalTransactions;
            document.getElementById('reportAvgSale').textContent = '‡ß≥' + Math.round(avgSale);

            // Load report table
            const tbody = document.getElementById('reportTable');
            tbody.innerHTML = '';

            filteredSales.reverse().forEach(sale => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${formatDateTime(sale.date)}</td>
                    <td>${sale.id}</td>
                    <td>${sale.customer}</td>
                    <td>‡ß≥${sale.totalAmount}</td>
                    <td>‡ß≥${sale.totalProfit}</td>
                `;
                tbody.appendChild(row);
            });

            if (filteredSales.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #666;">‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶ø‡¶§ ‡¶∏‡¶Æ‡¶Ø‡¶º‡ßá ‡¶ï‡ßã‡¶® ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶Ø‡¶º ‡¶®‡ßá‡¶á</td></tr>';
            }
        }

        // Make report functions global
        window.generateReport = generateReport;

        // Utility Functions
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('bn-BD');
        }

        function formatDateTime(dateString) {
            const date = new Date(dateString);
            return date.toLocaleString('bn-BD');
        }

        function showAlert(message, type = 'success') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.textContent = message;
            alertDiv.style.position = 'fixed';
            alertDiv.style.top = '20px';
            alertDiv.style.right = '20px';
            alertDiv.style.zIndex = '9999';
            
            document.body.appendChild(alertDiv);
            
            setTimeout(() => {
                alertDiv.remove();
            }, 3000);
        }

        // Initialize app when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Firebase will auto-connect and load data via the connection listener
            console.log('Pharmacy Management System initialized with Firebase');
        });

    </script>
</body>

</html>



